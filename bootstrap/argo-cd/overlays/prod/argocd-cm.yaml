---
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
data:
  application.resourceTrackingMethod: annotation
  resource.compareoptions: |
    # disables status field diffing in specified resource types
    ignoreAggregatedRoles: true
    # Use system-level ignoreDifferences to also ignore resource updates
    ignoreDifferencesOnResourceUpdates: true
    # Ignore differences in the `status` field
    ignoreResourceStatusField: all
  resource.customizations: |
    networking.k8s.io/Ingress:
      health.lua: |
        hs = {}
        hs.status = "Healthy"
        return hs
  kustomize.buildOptions: --enable-helm
  resource.customizations.ignoreDifferences.admissionregistration.k8s.io_MutatingWebhookConfiguration: |
    jqPathExpressions:
      - '.webhooks[]?.clientConfig.caBundle'
  resource.customizations.ignoreDifferences.admissionregistration.k8s.io_ValidatingWebhookConfiguration: |
    jqPathExpressions:
      - '.webhooks[]?.clientConfig.caBundle'
  resource.customizations.ignoreDifferences.all: |
    jsonPointers:
      - /metadata/annotations/kyverno.io~1restartedAt

  resource.customizations.ignoreResourceUpdates.all: |
    jsonPointers:
      - /status
      - /metadata/resourceVersion

  timeout.reconciliation: 1h
  url: https://argocd.example.com
  oidc.config: |
    name: Keycloak
    issuer: https://keycloak.example.com/realms/example
    clientID: argocd
    clientSecret: $oidc.keycloak.clientSecret
    requestedScopes: ["openid", "profile", "email", "groups"]
    rootCA: |

